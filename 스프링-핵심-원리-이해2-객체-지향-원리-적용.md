## **스프링 핵심 원리 이해2 - 객체 지향 원리 적용**
  * 새로운 할인 정책 개발
    
    ![image](https://user-images.githubusercontent.com/79301439/159166842-390a2b00-03c0-4236-a2ed-f62c6d713a84.png)

    ![image](https://user-images.githubusercontent.com/79301439/159166851-9ee97eb6-0902-40e8-b160-7db339cab1ee.png)

    * RateDiscountPolicy 코드 추가
      ```java
      package hello.core.discount;

      import hello.core.member.Grade;
      import hello.core.member.Member;

      public class RateDiscountPolicy implements DiscountPolicy {

          private int discountPercent = 10; //10% 할인

          @Override
          public int discount(Member member, int price) {
              if (member.getGrade() == Grade.VIP) {
                  return price * discountPercent / 100;
              } else {
                  return 0;
              }
          }
      }
      ```
    * 테스트 작성
      ```java
      package hello.core.discount;

      import hello.core.member.Grade;
      import hello.core.member.Member;
      import org.junit.jupiter.api.DisplayName;
      import org.junit.jupiter.api.Test;

      import static org.assertj.core.api.Assertions.assertThat;

      class RateDiscountPolicyTest {

          RateDiscountPolicy rateDiscountPolicy = new RateDiscountPolicy();

          @Test
          @DisplayName("VIP는 10% 할인이 적용되어야 한다.")
          void vip_o() {
              //given
              Member member = new Member(1L, "memberVIP", Grade.VIP);

              //when
              int discount = rateDiscountPolicy.discount(member, 10000);

              //then
              assertThat(discount).isEqualTo(1000);
          }

          @Test
          @DisplayName("VPI가 아니면 할인이 적용되지 않아야 한다.")
          void vip_x() {
              //given
              Member member = new Member(2L, "memberBASIC", Grade.BASIC);

              //when
              int discount = rateDiscountPolicy.discount(member, 10000);

              //then
              assertThat(discount).isEqualTo(0);
          }

      }
      ```
      
      ![image](https://user-images.githubusercontent.com/79301439/159166945-a9e42a1d-e4cf-4b4a-9ec6-96a41e6996bb.png)
***
  * 새로운 할인 정책 적용과 문제점
    * 할인 정책을 변경하려면 `OrderServiceImpl` 코드를 고쳐야 한다.
      ```java
      public class OrderServiceImpl implements OrderService {

          //private final DiscountPolicy discountPolicy = new FixDiscountFolicy();
          private final DiscountPolicy discountPolicy = new RateDiscountPolicy();
      
      }
      ```
    * 문제점 발견
      
      ![image](https://user-images.githubusercontent.com/79301439/159167994-a16c6795-9a95-4b59-8e72-65d15af7c758.png)
      
    * 왜 클라이언트 코드를 변경해야 할까?
     
      ![image](https://user-images.githubusercontent.com/79301439/159168041-fd156212-d5ae-4b28-bfea-8c333631c557.png)

      ![image](https://user-images.githubusercontent.com/79301439/159168089-099f7e49-caa4-4913-9ea2-48336d9249c7.png)

      ![image](https://user-images.githubusercontent.com/79301439/159168119-d01f2825-7c40-47ee-9709-aed76184e3ac.png)

    * 어떻게 문제를 해결할 수 있을까?

      ![image](https://user-images.githubusercontent.com/79301439/159168145-f0ebb1af-3519-4d51-b6e5-5e9561264e35.png)

    * 인터페이스에만 의존하도록 설계를 변경
    
      ![image](https://user-images.githubusercontent.com/79301439/159168205-03af152e-d89f-45cc-be10-b7ece3ef007a.png)
      
    * 인터페이스에만 의존하도록 코드 변경
      ```java
      public class OrderServiceImpl implements OrderService {

          //private final DiscountPolicy discountPolicy = new RateDiscountPolicy();
          private DiscountPolicy discountPolicy;
          
      }
      ```
      
      ![image](https://user-images.githubusercontent.com/79301439/159168283-de295c86-f10d-4f6d-bef4-ebdb0438d969.png)
      
    * 해결 방안
      
      ![image](https://user-images.githubusercontent.com/79301439/159168292-f715ba6a-3826-4cb5-9592-ee6cd3f1ef70.png)
***
  * 관심사의 분리
    
    ![image](https://user-images.githubusercontent.com/79301439/159170071-c50d9a26-832f-4e6e-936d-ca95dc52d3d0.png)

    ![image](https://user-images.githubusercontent.com/79301439/159170094-2d606ec0-4285-4c8c-b7fc-0a9ec1eab32e.png)
    
  * AppConfig 등장

    ![image](https://user-images.githubusercontent.com/79301439/159170114-3cb025d5-5eae-4ee1-ad8f-6a6fa5779b03.png)

    * AppConfig
      ```java
      package hello.core;

      import hello.core.discount.FixDiscountPolicy;
      import hello.core.member.MemberService;
      import hello.core.member.MemberServiceImpl;
      import hello.core.member.MemoryMemberRepository;
      import hello.core.order.OrderService;
      import hello.core.order.OrderServiceImpl;

      public class AppConfig {

          public MemberService memberService() {
              return new MemberServiceImpl(new MemoryMemberRepository());
          }

          public OrderService orderService() {
              return new OrderServiceImpl(new MemoryMemberRepository(), new FixDiscountPolicy());
          }

      }
      ```
      
      ![image](https://user-images.githubusercontent.com/79301439/159170188-e8aee737-eee0-40fe-92eb-b8fad3aec740.png)

    * MemberServiceImpl - 생성자 주입
      ```java
      package hello.core.member;

      public class MemberServiceImpl implements MemberService {

          private final MemberRepository memberRepository;

          public MemberServiceImpl(MemberRepository memberRepository) {
              this.memberRepository = memberRepository;
          }

          @Override
          public void join(Member member) {
              memberRepository.save(member);
          }

          @Override
          public Member findMember(Long memberId) {
              return memberRepository.findById(memberId);
          }
      }
      ```
      
      ![image](https://user-images.githubusercontent.com/79301439/159170297-2731bcb7-6374-41c5-8730-a3747afdb447.png)

    ![image](https://user-images.githubusercontent.com/79301439/159170346-9f5c6b33-f727-4deb-ae47-7ff3167088e6.png)

    ![image](https://user-images.githubusercontent.com/79301439/159170482-caf7edb9-e0a3-4c72-a169-fdc9fba9a5d4.png)

    * OrderServiceImpl - 생성자 주입
      ```java
      package hello.core.order;

      import hello.core.discount.DiscountPolicy;
      import hello.core.member.Member;
      import hello.core.member.MemberRepository;

      public class OrderServiceImpl implements OrderService {

          private final MemberRepository memberRepository;
          private final DiscountPolicy discountPolicy;

          public OrderServiceImpl(MemberRepository memberRepository, DiscountPolicy discountPolicy) {
              this.memberRepository = memberRepository;
              this.discountPolicy = discountPolicy;
          }

          @Override
          public Order createOrder(Long memberId, String itemName, int itemPrice) {
              Member member = memberRepository.findById(memberId);
              int discountPrice = discountPolicy.discount(member, itemPrice);

              return new Order(memberId, itemName, itemPrice, discountPrice);
          }
      }
      ```
      
      ![image](https://user-images.githubusercontent.com/79301439/159170575-551a234d-2543-436a-9141-595f9c70fa9c.png)

  * AppConfig 실행
    * 사용 클래스 - MemberApp
      ```java
      package hello.core;

      import hello.core.member.Grade;
      import hello.core.member.Member;
      import hello.core.member.MemberService;

      public class MemberApp {

          public static void main(String[] args) {
              AppConfig appConfig = new AppConfig();
              MemberService memberService = appConfig.memberService();
              Member member = new Member(1L, "memberA", Grade.VIP);
              memberService.join(member);

              Member findMember = memberService.findMember(1L);
              System.out.println("new member = " + member.getName());
              System.out.println("find Member = " + findMember.getName());
          }
      }
      ```
    * 사용 클래스 - OrderApp
      ```java
      package hello.core;

      import hello.core.member.Grade;
      import hello.core.member.Member;
      import hello.core.member.MemberService;
      import hello.core.order.Order;
      import hello.core.order.OrderService;

      public class OrderApp {

          public static void main(String[] args) {

              AppConfig appConfig = new AppConfig();
              MemberService memberService = appConfig.memberService();
              OrderService orderService = appConfig.orderService();

              Long memberId = 1L;
              Member member = new Member(memberId, "memberA", Grade.VIP);
              memberService.join(member);

              Order order = orderService.createOrder(memberId, "itemA", 10000);

              System.out.println("order = " + order);
          }
      }
      ```
    * 테스트 코드 오류 수정
      ```java
      package hello.core.member;

      import hello.core.AppConfig;
      import org.assertj.core.api.Assertions;
      import org.junit.jupiter.api.BeforeEach;
      import org.junit.jupiter.api.Test;

      class MemberServiceTest {

          MemberService memberService;

          @BeforeEach
          public void beforeEach() {
              AppConfig appConfig = new AppConfig();
              memberService = appConfig.memberService();
          }

          @Test
          void join() {
              //given
              Member member = new Member(1L, "memberA", Grade.VIP);

              //when
              memberService.join(member);
              Member findMember = memberService.findMember(member.getId());

              //then
              Assertions.assertThat(member).isEqualTo(findMember);
          }
      }
      ```
      ```java
      package hello.core.order;

      import hello.core.AppConfig;
      import hello.core.member.Grade;
      import hello.core.member.Member;
      import hello.core.member.MemberService;
      import org.assertj.core.api.Assertions;
      import org.junit.jupiter.api.BeforeEach;
      import org.junit.jupiter.api.Test;

      class OrderServiceTest {

          MemberService memberService;
          OrderService orderService;

          @BeforeEach
          public void beforeEach() {
              AppConfig appConfig = new AppConfig();
              memberService = appConfig.memberService();
              orderService = appConfig.orderService();
          }

          @Test
          void createOrder() {
              Long memberId = 1L;
              Member member = new Member(memberId, "memberA", Grade.VIP);
              memberService.join(member);

              Order order = orderService.createOrder(memberId, "itemA", 10000);
              Assertions.assertThat(order.getDiscountPrice()).isEqualTo(1000);
          }
      }
      ```
      
      ![image](https://user-images.githubusercontent.com/79301439/159170745-1aa83b47-f8d3-4510-84c6-03b3b4c49b13.png)
      
  * 정리
    
    ![image](https://user-images.githubusercontent.com/79301439/159170759-ce4093a0-9a78-4c4c-a7fa-6778ff6f38b4.png)
